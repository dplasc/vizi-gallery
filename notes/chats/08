**Chat #8**

### 2. Naslov chata

**Vizi.hr — Onboarding flow (username setup) + auth redirect stabilizacija**

### 3. Faza projekta

**FAZA 4 — Onboarding flow (save username za prijavljenog usera)**

### 4. Što smo konkretno napravili / zaključili

* Implementiran **Server Action `upsertProfileUsername`**:

  * normalizacija i validacija username-a
  * auth guard (UNAUTHORIZED)
  * provjera zauzetosti username-a (USERNAME_TAKEN)
  * stabilan update → insert fallback bez insert-on-error buga
* Dodana **onboarding stranica `/onboarding`**:

  * server component s auth provjerom
  * redirect na `/login` ako user nije prijavljen
  * redirect na `/${username}` ako profil već ima username
* Dodana **client onboarding forma**:

  * shadcn/ui komponente
  * submit na server action
  * error handling i loading state
* Očišćene sve **neplanirane izmjene** izvan scope-a
* Promijenjen **auth success redirect**:

  * nakon login/signup → `/onboarding` (umjesto `/app`)
* Svi koraci odrađeni **disciplinirano, 1 po 1**, uz diff review
* Commitani:

  * onboarding flow
  * auth redirect fix

### 5. Što je IZRIČITO odlučeno / zaključano

* Onboarding je **obavezan korak** nakon login/signup
* Username se postavlja **isključivo kroz onboarding**
* Struktura:

  * `/onboarding/page.tsx` = server (auth + redirect)
  * `/onboarding/onboarding-form.tsx` = client (UI + submit)
* Nema dashboard redirecta dok onboarding nije završen
* Nema dodatnih tablica ni CMS logike

### 6. Otvorene stavke

* Nema otvorenih stavki u FAZI 4

### 7. Sljedeći dogovoreni korak (jedan)

* **Push svih commitova na `origin/main` i end-to-end test onboarding flowa na productionu**

### 8. Napomena za nastavak u novom chatu

* Novi chat započeti s kontekstom: **FAZA 5 — Public profile UX (render `/[username]` stranice)**
* Fokus: prikaz profila na temelju već stabilnog public API-ja i onboarding flowa, bez širenja scope-a.

